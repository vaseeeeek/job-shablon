$(function(){$.blog_utils.highlight("#post-list");var t=function(t,a,r){e(),$(".comment-form").find("input[name=parent]").val(a);var i=$(".comment-form").show().insertAfter(t).find("[name=text]").val("");r&&i.focus()},e=function(t){var e=$(".comment-form");e.find(".errormsg").remove(),e.find(".error").removeClass("error"),e.find(".wa-captcha-refresh").click(),t&&e.find("textarea").val("")};$(".comment-reply").live("click",function(){var e=$(this).parents(".comment"),a=e.length?parseInt($(e).attr("id").replace(/^[\D]+/,"")):0;return t($(this).parent(),a,!0),$(".comment").removeClass("in-reply-to"),e.addClass("in-reply-to"),!1}),$(".comment-form input:submit").click(function(){var a=$(this);a.attr("disabled",!0).next().show();var r=$(".comment-form"),i=$(".comment-form form");return $.post(i.attr("action")+"?json=1",i.serialize(),function(i){if(a.attr("disabled",!1).next().hide(),i.status&&"ok"==i.status&&i.data.redirect)return window.location.replace(i.data.redirect),void(window.location.href=i.data.redirect);if(i.status&&"ok"==i.status&&i.data){var n,o=$(i.data.template),s=i.data.count_str;r.prev().is(".comments")?n=r.prev(".comments").children("ul"):(n=r.parent(),n.next("ul").size()||n.after("<ul></ul>"),n=n.next("ul")),n.append($("<li />").append(o)),t(".comments",0),i.data.comment_id&&$("#comment-"+i.data.comment_id).addClass("new"),$(".not-comment").remove(),$(".comment").removeClass("in-reply-to"),$(".comment-count").show().html(s),o.trigger("plugin.comment_add"),e(!0)}else if(i.status&&"fail"==i.status){e();var m=i.errors;$(m).each(function(t){var e=this;for(name in e){$(".comment-form form").find("[name="+name+"]").after($('<em class="errormsg"></em>').text(e[name])).addClass("error")}})}else e(!1)},"json").error(function(){e(!1)}),!1});var a="guest",r=$("ul#user-auth-provider li.selected");r.length?a=r.attr("data-provider")||a:(r=$("#user-auth-provider"),r.length&&(a=r.attr("data-provider")||a)),a&&($(".tab").hide(),"signup"==a?$(".comment-submit, .comment-body").hide():$(".comment-submit, .comment-body").show(),$("div.tab[data-provider='"+a+"']").show(),$("input[name=auth_provider]").val(a),"guest"==a?$(".wa-captcha").show():$(".wa-captcha").hide()),$("ul#user-auth-provider li.selected a, ul#user-auth-provider li:eq(0) a").click(function(){if($(this).parent().hasClass("selected"))return!1;var t=$(this).parent().attr("data-provider");return $(this).parent().addClass("selected").siblings().removeClass("selected"),$(".tab").hide(),$("div.tab[data-provider='"+t+"']").show(),"guest"==t?$(".wa-captcha").show():$(".wa-captcha").hide(),"signup"==t?$(".comment-submit, .comment-body").hide():$(".comment-submit, .comment-body").show(),$("input[name=auth_provider]").val(t),!1})}),$.blog_utils={query:"",init:function(){if(-1!==location.href.indexOf("?"))for(var t=location.href.indexOf("?"),e=location.href.slice(t+1).split("&"),a=0;a<e.length;a+=1)if(-1!==e[a].indexOf("query=")){this.query=e[a].slice(e[a].indexOf("query=")+6);break}},highlight:function(t){this.query&&$(t).find(".search-match").find("h3 a, p").each(function(){var t=$(this).html();t=t.replace(new RegExp("("+$.blog_utils.query+")","i"),'<span class="highlighted">$1</span>'),$(this).html(t)})}},$.blog_utils.init();