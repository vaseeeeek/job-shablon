{strip}

{if class_exists('blogSkimagePlugin')}
    {$skImage = blogSkimageHelper::getImages()}
{/if}

{foreach $posts as $post}
    <section class="post post-item" id="post-{$post.id}">
        <div class="post-item_head">
            <h3>
                <span class="date bg-sdColor">{$post.datetime|wa_datetime:"humandate"}</span>
                <a href="{$post.link}">{$post.title}</a>
                {if !empty($post.plugins.post_title)}
                    {foreach $post.plugins.post_title as $plugin => $output}{$output}{/foreach}
                {/if}
            </h3>
        </div>

        <div class="post-box_credentials">

            {if isset($post.user.photo_url_20)}
                {if $post.user.posts_link}
                    <a href="{$post.user.posts_link}">
                        <img src="{$post.user.photo_url_20}" class="userpic" alt="{$post.user.name}">
                    </a>
                {else}
                    <img src="{$post.user.photo_url_20}" class="userpic" alt="{$post.user.name}">
                {/if}
            {/if}

            {if $post.user.posts_link}
                <a href="{$post.user.posts_link}" class="username">{$post.user.name}</a>
            {else }
                <span class="username">{$post.user.name}</span>
            {/if}

            {if $show_comments && $post.comments_allowed}
                <div class="post-box_credentials_comments">
                    {if !empty($post.comment_count)}
                        <a href="{$post.link}#comments" class="small">
                            {_w('%d comment','%d comments',$post.comment_count)}
                        </a>
                    {else}
                        <a href="{$post.link}#comments" class="hint">
                            [`no comments`]
                        </a>

                    {/if}
                </div>
            {/if}

        </div>

        {if !empty($post.plugins.before)}
            <div class="text_before">
                {foreach $post.plugins.before as $plugin => $output}{$output}{/foreach}
            </div>
        {/if}

        <div class="text">
            {$image = ""}
            {if isset($skImage[$post.id]['preview']) && !empty($skImage[$post.id]['preview'])}
                {$image = $skImage[$post.id]['preview']}
            {/if}
            {$post.text}
            {if $post.cutted}
                <a class="post-item_next link-btn" href="{$post.link}">{$post.cut_link_label|default:'[`Continue reading â†’`]'}</a>
            {/if}
        </div>
        {if $post.album_id && $post.album.id && $post.album.photos}
            {$photos_loaded = 1}
            <div class="photo-album--blog">
                <ul class="thumbs">
                    {foreach $post.album.photos as $p}
                        <li><a href="{$post.link}#photo{$p.id}"><img src="{$p.thumb_crop.url}" width="96" height="96" alt="{$p.name|escape}"></a></li>
                    {/foreach}
                </ul>
            </div>
        {/if}
        {if !empty($post.plugins.after)}
            <div class="text_after">
                {foreach $post.plugins.after as $plugin => $output}{$output}{/foreach}
            </div>
        {/if}

    </section>
{foreachelse}
    {if $page < 2}
        <div class="content-box">{_w('%d post','%d posts',0)}</div>
    {/if}
{/foreach}
{/strip}
