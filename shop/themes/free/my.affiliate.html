{strip}
    <h1>[`Affiliate program`]</h1>
    {$balance = round($customer.affiliate_bonus, 2)|wa_format_number:false}
    {if $customer.affiliate_bonus >= 0}{$balance = '+'|cat:$balance}{/if}
    <p class="large">{sprintf('[`Your current affiliate bonus: <strong class="bonus">%s</strong>`]', $balance)}</strong></p>
    {$_active_affiliate_plugins = 0}
    <!-- plugin hook: 'frontend_my_affiliate' -->
    {* @event frontend_my_affiliate.%plugin_id% *}
    {foreach $frontend_my_affiliate as $_}{$_}{$_active_affiliate_plugins = 1}{/foreach}

    {if $_active_affiliate_plugins}<br><br><h2>[`Bonus activity log`]</h2>{/if}
    <table class="table">
        {if !empty($affiliate_history)}
            {if !$wa->isMobile()}
                <tr class="white">
                    <th></th>
                    <th></th>
                    <th>[`Credit`]</th>
                    <th>[`Debit`]</th>
                    <th>[`Balance`]</th>
                </tr>
                {foreach $affiliate_history as $one_story}
                    <tr>
                        <td class="gray">{$one_story.create_datetime|wa_date:'humandatetime'}</td>
                        <td>
                            {if $one_story.order_id && !empty($one_story.order_url)}
                                <a href="{$one_story.order_url}">[`Order`] {$wa->shop->orderId($one_story.order_id)}</a>
                                {if $one_story.comment}<br>{/if}
                            {/if}
                            {if $one_story.comment}
                                {$one_story.comment|escape}
                            {/if}
                        </td>
                        <td>
                            {if $one_story.amount > 0}
                                {round($one_story.amount,2)|wa_format_number:false}
                            {/if}
                        </td>
                        <td>
                            {if $one_story.amount < 0}
                                {round(abs($one_story.amount),2)|wa_format_number:false}
                            {/if}
                        </td>
                        <td>{round($one_story.balance,2)|wa_format_number:false}</td>
                    </tr>
                {/foreach}
            {else}

                {foreach $affiliate_history as $one_story}
                    <tr>
                        <td>
                            <div class="hint"> {$one_story.create_datetime|wa_date:'humandatetime'}</div>
                            {if $one_story.order_id && !empty($one_story.order_url)}
                                <a href="{$one_story.order_url}">[`Order`] {$wa->shop->orderId($one_story.order_id)}</a>
                                {if $one_story.comment}<br>{/if}
                            {/if}
                            {if $one_story.comment}
                                {$one_story.comment|escape}
                            {/if}
                        </td>
                        <td>
                            {if $one_story.amount > 0}
                                <strong>[`Credit`]:</strong>
                                {round($one_story.amount,2)|wa_format_number:false}
                                <br>
                            {/if}

                            {if $one_story.amount < 0}
                                <strong>[`Debit`]:</strong>
                                {round(abs($one_story.amount),2)|wa_format_number:false}
                                <br>
                            {/if}
                            <strong>[`Balance`]:</strong> {round($one_story.balance,2)|wa_format_number:false}
                        </td>
                    </tr>
                {/foreach}
            {/if}
        {else}
            <tr>
                <td>[`You have no affiliate history yet.`]</td>
            </tr>
        {/if}
    </table>
    {$wa->globals('isMyAccount', true)}
{/strip}