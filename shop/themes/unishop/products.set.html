{strip}
{if isset($list_id) && !empty($list_id)}
    {$current_lang = $wa->locale()}
    {if !isset($theme_settings.product_show_tile_features)}{$theme_settings.product_show_tile_features = false}{/if}
    {if !isset($theme_settings.add_order_action )}{$theme_settings.add_order_action  = 'move'}{/if}
    {if !isset($theme_settings.product_show_tile_mobile_features)}{$theme_settings.product_show_tile_mobile_features = false}{/if}
    {if !isset($theme_settings.price_range_in_product_list)}{$theme_settings.price_range_in_product_list = false}{/if}
    {if !isset($theme_settings.favorites)}{$theme_settings.favorites = true}{/if}
    {if !isset($theme_settings.compare)}{$theme_settings.compare = true}{/if}
    {if $wa_app != 'shop' || !isset($theme_settings.product_preview_dialog)}{$theme_settings.product_preview_dialog = ($wa_app == 'shop')}{/if}
    {if !isset($theme_settings.preview_stock)}{$theme_settings.preview_stock  = true}{/if}
    {if !isset($theme_settings.preview_stock_count)}{$theme_settings.preview_stock_count  = false}{/if}
    {if !isset($theme_settings.text_product_preorder)}{$theme_settings.text_product_preorder = false}{/if}
    {if !isset($theme_settings.product_ratings)}{$theme_settings.product_ratings = true}{/if}
    {if !isset($theme_settings.badge_saving)}{$theme_settings.badge_saving = false}{/if}
    {if !isset($theme_settings.product_discount_percentage)}{$theme_settings.product_discount_percentage = false}{/if}
    {if !isset($theme_settings.show_grid_sku)}{$theme_settings.show_grid_sku = false}{/if}
    {if !isset($theme_settings.disabled_button_cart_zero_price)}{$theme_settings.disabled_button_cart_zero_price = false}{/if}
    {if !isset($theme_settings.product_show_preview_video)}{$theme_settings.product_show_preview_video = true}{/if}
    {if $wa_app != 'shop' || !isset($theme_settings.product_scroll_hover_gallery)}{$theme_settings.product_scroll_hover_gallery = false}{/if}
    {if $wa_app != 'shop' || !isset($theme_settings.product_preview_images_lazy)}{$theme_settings.product_preview_images_lazy = false}{/if}
    {if !isset($theme_settings.text_zero_price)}
        {$theme_settings.text_zero_price = "Price on request"}
        {if $current_lang == 'ru_RU'}
            {$theme_settings.text_zero_price = "Цена по запросу"}
        {/if}
    {/if}
    {if !isset($theme_settings.text_not_avalible)}{$theme_settings.text_not_avalible = false}{/if}

    {if !isset($favorites)}
        {$favorites = $wa->cookie('product_favor_arr')}
        {if $favorites}{$favorites = ","|explode:$favorites}{else}{$favorites = []}{/if}
    {/if}

    {if $wa_app != 'shop' && $current_lang == 'ru_RU'}
        {$text_in_stock = "В наличии"}
        {$text_unit = "шт."}
        {$text_product_preorder_only = "Под заказ"}
        {$text_out_stock = "Нет на складе"}
        {$text_art_code = "Артикул"}
    {/if}
    <script>
        let imgObjProducts = new Object();
    </script>
    {$products = $wa->shop->productSet($list_id)}
    {if count($products)}
        {if !isset($theme_path) && empty($theme_path)}
            {$theme_path = $wa->shop->themePath('unishop')}
        {/if}
        <div class="js-preview-products products-tile products-tile--custom" data-retina="{$wa->shop->config('enable_2x')}" data-image-lazy="{$theme_settings.product_preview_images_lazy}">
            {foreach $products as $p}
                {include file="`$theme_path`product-preview-tile.html" product=$p theme_path=$theme_path}
            {/foreach}
        </div>
    {/if}
{/if}
{/strip}


{if !$wa->isMobile()}
    <style>
        .grid-gallery__list {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            display: -ms-flexbox;
            display: flex;
        }
        span.grid-gallery__el.js-grid-gallery-item {
            z-index: 2;
        }
        ._tile-active .grid-gallery__el {
            position: relative;
        }
    </style>
    <script>
        $(function () {
            $(".grid-gallery__el").hover(function() {
                let _this = $(this);
                let id = _this.attr('data-id');
                console.log(id);
                let wrap = _this.closest('.Product-grid');
                wrap.find('.dotted-img__item').each(function() {
                    if ($(this).attr('data-id') == id) {
                        $(this).addClass('-Active');
                    } else {
                        $(this).removeClass('-Active');
                    }
                });
            });
            $('.Product-grid_img').mouseout(function() {
                $('.dotted-img__item').each(function() {
                    if ($(this).attr('data-id') == 1) {
                        $(this).addClass('-Active');
                    } else {
                        $(this).removeClass('-Active');
                    }
                });
            })
        })
    </script>
{else}
    <script>
        var startCoords = {},
            endCoords = {};
        let productId = '';
        let product = '';
        $('.Product-grid_img').bind("touchstart", function(event) {
            startCoords = endCoords = event.originalEvent.targetTouches[0];
            product = $(this).closest('.Product-grid');
            productId = $(this).closest('.Product-grid').attr("data-product-num");
        });
        $('.Product-grid_img').bind("touchmove", function(event) {
            endCoords = event.originalEvent.targetTouches[0];
        });
        {literal}
        $('.Product-grid_img').bind("touchend", function() {
            let mobileProductWrapDotted = product.find('.dotted-img__item');
            let startSrc = $(this).find('.js-product-preview-img').attr("src");
            imgObjProducts[productId].forEach((element, index) => {
                if (startSrc == element) {
                    startSrcIndex = index;
                    if (startCoords.clientX < endCoords.clientX){ // назад
                        endSrcIndex = startSrcIndex - 1;
                        $(this).find('.js-product-preview-img').attr("src", imgObjProducts[productId][endSrcIndex]);
                        mobileProductWrapDotted.each(function() {
                            if (endSrcIndex >= 0) {
                                if ($(this).attr('data-id') == endSrcIndex + 1) {
                                    $(this).addClass('-Active');
                                } else {
                                    $(this).removeClass('-Active');
                                }
                            }
                        });
                    }
                    if (startCoords.clientX > endCoords.clientX){ // след
                        endSrcIndex = startSrcIndex + 1;
                        $(this).find('.js-product-preview-img').attr("src", imgObjProducts[productId][endSrcIndex]);
                        mobileProductWrapDotted.each(function() {
                            if (endSrcIndex < mobileProductWrapDotted.length) {
                                if ($(this).attr('data-id') == endSrcIndex + 1) {
                                    $(this).addClass('-Active');
                                } else {
                                    $(this).removeClass('-Active');
                                }
                            }
                        });
                    }
                }
            })
        });
        {/literal}
    </script>
{/if}
