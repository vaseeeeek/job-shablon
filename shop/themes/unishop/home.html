
{$mPromoCards = $wa->shop->promos()|array_values}

<div class="container">
    {if $theme_settings.sidebar_mainpage}
        <div class="left-sidebar mainpage-sidebar">
            {if $theme_settings.sidebar_mainpage}
                {include file="`$wa_parent_theme_path`/header.categories.html"}
            {/if}
        </div>

        <div class="with-sidebar cols-2"> 
    {/if}

    {include file="slider.html"}
    {if !$theme_settings.sidebar_mainpage}
        </div>
    {else}
            </div>
        </div>
    {/if}

    {if $theme_settings.is_homepage_promos}
        <div class="container">{include file="promos.html"}</div>
    {/if}

    {if $theme_settings.categories_home_page}
        {$categories = $wa->shop->categories(0, null, true, true)}
        {if count($categories) > 0}
            <div class="container">
                <div class="homepage-categories">
                    {if class_exists('shopWmimageincatPlugin')}
                        {$Wmimages = shopWmimageincatPlugin::getCategoryImageObj()}
                    {/if}

                    <!-- Спросить о настройке -->
                    {if $theme_settings.total_max_maxcat_homepage}
                        {include file="categories.disclosed.html" categories=$categories}
                    {else}
                        {include file="categories.tile.html" categories=$categories}
                    {/if}
                </div>
            </div>
        {/if}
    {/if}

{if $theme_settings.homepage_product_view == "carousel"}
    {$product_list_file = "home.products-carousel.html"}
{else}
    {$product_list_file = "home.products-list.html"}
{/if}

{include file=$product_list_file products_list_id=$theme_settings.homepage_product_list_1 list_title=$theme_settings.homepage_product_list_1_title}
{include file=$product_list_file products_list_id=$theme_settings.homepage_product_list_2 list_title=$theme_settings.homepage_product_list_2_title}
{include file=$product_list_file products_list_id=$theme_settings.homepage_product_list_3 list_title=$theme_settings.homepage_product_list_3_title}


<div class="container">

    {if $theme_settings.use_plugin_brands == 'brands_pro'}
        {include file="home.brand-pro.html"}
    {else if $theme_settings.use_plugin_brands == 'brands'}
        {include file="home.brands.html"}
    {/if}

    <!-- plugin hook: 'frontend_homepage' -->
    {* @event frontend_homepage.%plugin_id% *}
    {foreach $frontend_homepage as $_}<div class="content content-box">{$_}</div>{/foreach}
</div>

{$is_news = false}
{if ($theme_settings.home_lastposts && $wa->blog)}
    {$blog_id = (int)$theme_settings.homepage_blog_id}
    {if empty($blog_id)}{$blog_id = null}{/if}
    {$blog_posts = $wa->blog->posts($blog_id,3)}
    {if !empty($blog_posts) && count($blog_posts)}
        {$is_news = true}
    {/if}
{/if}

{if !empty($theme_settings.home_text_head) || !empty($theme_settings.home_text_note) || !empty($is_news) || $countWidgets > 0}
    <div class="homepage-text-outer">
        {if !empty($theme_settings.home_text_head) || !empty($theme_settings.home_text_note)}
            <div class="homepage-text">
                <div class="container clearfix">
                    {if !empty($theme_settings.home_text_head)}
                    <h1>{$theme_settings.home_text_head}</h1>
                    {/if}
                    {$theme_settings.home_text_note}
                </div>
            </div>
        {/if}
        {if $is_news}
            {if class_exists('blogSkimagePlugin')}
                {$sk_blog_images = blogSkimageHelper::getImages()}
            {/if}
            <div class="container">
                <ul class="home-prev-news clear-list">
                    {foreach $blog_posts as $item}
                        <li class="home-prev-news_item">
                            {$image = ""}
                            {if isset($item.image_small) && !empty($item.image_small)}
                                {$image = $item.image_small}
                            {/if}
                            {if empty($image) && isset($item.image) && !empty($item.image)}
                                {$image = $item.image}
                            {/if}
                            {if isset($sk_blog_images[$item.id]['preview']) && !empty($sk_blog_images[$item.id]['preview'])}
                                {$image = $sk_blog_images[$item.id]['preview']}
                            {/if}
                            {if !empty($image)}
                                <a href="{$item.link}" class="home-prev-news_item-image">
                                    {if $theme_settings.home_blog_img_lazy}
                                        <img class="js-image-lazy" src="{$wa_theme_url}img/lazy-image.png" data-src="{$image}" alt="{$item.title}">
                                    {else}
                                        <img src="{$image}" alt="{$item.title}">
                                    {/if}
                                </a>
                            {/if}
                            <div class="home-prev-news_item-info">
                                <div class="home-prev-news_item-name">
                                    <span class="home-prev-news_item-date">{$item.datetime|wa_datetime:"humandate"}</span>
                                    <a href="{$item.link}">{$item.title}</a>
                                </div>
                                <div class="home-prev-news_item-text">
                                    {strip_tags($item.text)|truncate:128}
                                </div>

                                <div class="home-prev-news_item-more sdColor">
                                    <a href="{$item.link}">[`Read more`]</a> &rarr;
                                </div>
                            </div>
                        </li>
                    {/foreach}
                </ul>
            </div>
        {/if}
    </div>
{/if}
{/strip}
