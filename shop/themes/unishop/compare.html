{strip}
{$default_img = "`$wa_theme_url`img/dummy96.png"}
{if !empty($theme_settings.default_img)}
    {$default_img = "`$wa_parent_theme_url``$theme_settings.default_img`"}
{/if}
<div class="js-content content content-block">
    <div class="compare-header">
        <ul class="compare-diff-all ul-block">
            <li class="selected br-sdColor sdColor"><a id="compare-all" href="#">[`All features`]</a></li>
            <li class="br-sdColor sdColor"><a id="compare-diff" href="#">[`Different`]</a></li>
        </ul>

        <h1>[`Compare products`]</h1>
    </div>
    {literal}
    <script type="text/javascript">
    $(function () {
        $("#compare-all").click(function () {
            $("#compare-table tr.same").show();
            $(this).closest('ul').find('li.selected').removeClass('selected');
            $(this).parent().addClass('selected');
            return false;
        });
        $("#compare-diff").click(function () {
            $("#compare-table tr.same").hide();
            $(this).closest('ul').find('li.selected').removeClass('selected');
            $(this).parent().addClass('selected');
            return false;
        });
        $(".compare-remove").on('click', function () {
            var compare = $.cookie('shop_compare');
            if (compare) {
                compare = compare.split(',');
            } else {
                compare = [];
            }
            var i = $.inArray($(this).data('product') + '', compare);
            if (i != -1) {
                compare.splice(i, 1)
            }
            if (compare.length) {
                $.cookie('shop_compare', compare.join(','), { expires: 30, path: '/'});
            } else {
                $.cookie('shop_compare', null, {path: '/'});
            }
        });

        $('#compare-clear').on('click', function () {
            $.cookie('shop_compare', null, {path: '/'});
            location.href = location.href.replace(/compare\/.*/, 'compare/');
        });

        var fixed = $("#compare-table-fixed").append($("#compare-table > thead").clone());

    });
    </script>
    {/literal}

    {if count($products)}
        {$td_width = round((100-25)/max(1,count($products)))}
        <div class="compare-table">
            <table id="compare-table" class="compare">
                <thead>
                    <tr>
                        <th></th>
                        {$product_names = ''}
                        {foreach $products as $p name=product_names}
                            <td class="align-center" width="{$td_width}%">
                                <a href="{$wa->getUrl('/frontend/product/', ['product_url' => $p.url])}">
                                    {$wa->shop->productImgHtml($p, '70', ['itemprop' => 'image', 'id' => 'product-image', 'default' => $default_img, 'title' => $p.name|cat:' ':strip_tags($p.summary)|escape])}
                                </a>
                                <div class="name-wrapper">
                                    <a class="name-link" href="{$wa->getUrl('/frontend/product/', ['product_url' => $p.url])}">{$p.name}</a>
                                    <a class="compare-remove" href="{$p.delete_url}" title="[`Remove from comparison list`]" data-product="{$p.id}"><i class="icon16 remove"></i></a>
                                </div>

                                {$product_names = $product_names|cat:($p.name)}
                                {if !$smarty.foreach.product_names.last}{$product_names = $product_names|cat:', '}{/if}

                            </td>
                        {/foreach}
                    </tr>
                </thead>
                <tr>
                    <th>[`Price`]</th>
                    {foreach $products as $p}
                        <td width="{$td_width}%">
                            <span class="price nowrap">
                                {if empty($p.price) && !empty($theme_settings.text_zero_price)}
                                    {$theme_settings.text_zero_price}
                                {else}
                                    {shop_currency_html($p.price)}
                                {/if}
                            </span>
                        </td>
                    {/foreach}
                </tr>
                {foreach $features as $f_id=>$f}
                <tr{if $f.same} class="same"{/if}>
                    <th>{$f.name}</th>
                    {foreach $products as $p}
                        <td>
                        {if isset($p.features[$f_id])}
                            {if is_array($p.features[$f_id])}
                                {implode('<br> ', $p.features[$f_id])}
                            {else}
                                {$p.features[$f_id]}
                            {/if}
                        {else}
                            <span class="gray">&mdash;</span>
                        {/if}
                        </td>
                    {/foreach}
                </tr>
                {/foreach}
            </table>
        </div>

        <div class="align-center">
            <input id="compare-clear" type="button" class="gray" value="[`Clear comparison list`]">
        </div>

        <table id="compare-table-fixed" class="compare compare-fixed" style="position: fixed; top: 0px; display:none; background: white;"></table>
        <style>
            #compare-leash { display: none; }
            .page-content { overflow-x: scroll; }
        </style>
        {$wa->title( sprintf('[`Compare %s`]', $product_names) )}

    {else}

        <p>[`Product comparison list is empty.`]</p>

    {/if}

</div>
{/strip}